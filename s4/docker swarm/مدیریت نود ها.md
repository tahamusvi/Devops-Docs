ุฑุณุฏู ุจู ุณุทุญ ุญุฑููโุง ูุฏุฑุช ฺฉูุงุณุชุฑ Docker Swarm ๐  
ุงู ูุจุงุญุซ ุจุฑุง ูุฏุฑุช **ูพุงุฏุงุฑ ู ุงูู** ฺฉ Swarm ูุงูุน ู production-grade ูุณุชู. ุจุฑู ุจูโุตูุฑุช ุฏูู ู ุนูู ุจุฑุฑุณ ฺฉูู:

---

## โ ฑ. Promoting / Demoting Nodes (manager โ worker)

### ๐ผ Promote:

ุชุจุฏู ฺฉ worker ุจู manager:

```bash
docker node promote node2
```

### ๐ฝ Demote:

ุชุจุฏู manager ุจู worker:

```bash
docker node demote node2
```

๐ง ูฺฉุชู:

- ููุท Managerูุง ูโุชููู ุงู ฺฉุงุฑ ุฑู ุงูุฌุงู ุจุฏู
    
- Managerูุง ุฏุฑ ุฑุฃโฺฏุฑ (Raft) ุดุฑฺฉุช ูโฺฉููุ ุจุดุชุฑ ุงุฒ ูุงุฒุ ุฎุทุฑูุงฺฉ ูโุดู
    

---

## โ ฒ. ุงุถุงูู ู ุญุฐู ููุฏูุง ุงุฒ Swarm

### ุงุถุงููโฺฉุฑุฏู ููุฏ:

```bash
docker swarm join --token <token> <manager-ip>:2377
```

### ุญุฐู ููุฏ (ุงุฒ ุณูุช manager):

```bash
docker node rm <node-name>
```

ุงฺฏุฑ ููุฏ ุขููุงู ุจุงุดูุ ุจุงุฏ `--force` ุจุฒู.

---

## โ ณ. Drain / Pause / Active

### ูุฏู: ฺฉูุชุฑู ฺฉุฏูู ููุฏูุง ุชุณฺฉ ุงุฌุฑุง ฺฉูู ุง ูฺฉูู.

- **Active**: ููุฏ ูโุชููู ุชุณฺฉ ุฌุฏุฏ ุจฺฏุฑู (ูพุดโูุฑุถ)
    
- **Pause**: ูุซู Active ูู ุชุง ููุช ุชุณฺฉ ุฏุงุฑูุ ูฺฏู ูโุฏุงุฑู
    
- **Drain**: ุชุณฺฉโูุง ููุฏ ุจู ููุฏูุง ุฏฺฏู ููุชูู ูโุดู (ุจุฑุง ุชุนูุฑ/ุฎุฑูุฌ)
    

### ุฏุณุชูุฑ:

```bash
docker node update --availability drain node2
```

---

## โ ด. Swarm Raft Consensus ู Quorum

Swarm ุงุฒ ุงูฺฏูุฑุชู **Raft** ุจุฑุง ููุงููฺฏ ุจู Managerูุง ุงุณุชูุงุฏู ูโฺฉูู.

|ุงุตุทูุงุญ|ุชูุถุญ|
|---|---|
|**Raft**|ุงูฺฏูุฑุชู ุชูุฒุนโุดุฏู ุจุฑุง ููุงููฺฏ ู ุงุฌูุงุน|
|**Quorum**|ุญุฏุงูู ุชุนุฏุงุฏ Managerูุง ูุนุงู ุจุฑุง ุงุฏุงููโ ฺฉุงุฑ Swarm|
|ูุฑููู|`ceil(N / 2)` ุงุฒ N=ุชุนุฏุงุฏ Managerูุง|

ูุซุงู:

- ุงฺฏุฑ 3 Manager ุฏุงุดุชู ุจุงุด โ ุจุงุฏ ุญุฏุงูู 2 ุชุง Active ุจุงุดู
    
- ุงฺฏู quorum ุฑู ุงุฒ ุฏุณุช ุจุฏ โ ูฺ ุขูพุฏุช ุฏุฑ ุณุฑูุณ ููฺฉู ูุณุช (ููุท ุฎูุงูุฏู ููฺฉูู)
    

---

## โ ต. Auto-lock ู Swarm Encryption

### ๐ Auto-lock:

ููุช Auto-lock ูุนุงู ุจุงุดูุ ูุฑ ุจุงุฑ Docker daemon ุฑโุงุณุชุงุฑุช ุจุดูุ ุจุงุฏ `unlock-key` ุจุฏ.

```bash
docker swarm update --autolock=true
docker swarm unlock-key
```

ุจุฑุง unlock:

```bash
docker swarm unlock
```

๐ ููุงุณุจ ุจุฑุง ุงููุช Swarm ุฏุฑ ุตูุฑุช reboot/restart daemon.

---

## โ ถ. ุงุณุชูุงุฏู ุงุฒ TLS ุจู ููุฏูุง

Docker Swarm **ุจูโุตูุฑุช ูพุดโูุฑุถ** ุงุฑุชุจุงุท ุจู ููุฏูุง ุฑู ุจุง **TLS** ุฑูุฒูฺฏุงุฑ ูโฺฉูู.

ูฺฺฏโูุง:

- Authenticated mutual TLS
    
- Certificate rotation ุฎูุฏฺฉุงุฑ
    
- Private CA ุฏุงุฎู ุฏุฑ Swarm
    

๐ ูุงุฒ ุจู ุชูุธูุงุช ุฏุณุช ูุฏุงุฑูุ ูููโฺุฒ secure-by-default ูุณุช.

---

## โ ท. Snapshot ู Backup ุงุฒ Swarm (Raft state)

Swarm ฺฉู state (ุณุฑูุณโูุงุ ููุฏูุงุ configูุง...) ุฑู ุฏุฑ ฺฉ ุฏุชุงุจุณ Raft ุฐุฎุฑู ูโฺฉูู ุฏุฑ ูุณุฑ:

```bash
/var/lib/docker/swarm/
```

### ุจฺฉุงูพ ฺฏุฑูุชู:

1. ุฑู Manager Leader:
    
    ```bash
    docker node ls   # ูพุฏุง ฺฉุฑุฏู leader
    ```
    
2. ุจฺฉุงูพ:
    
    ```bash
    sudo tar czvf swarm-backup.tar.gz /var/lib/docker/swarm
    ```
    

### ุฑุณุชูุฑ:

1. Stop Docker
    
2. ุฌุงฺฏุฒู `/var/lib/docker/swarm` ุจุง ุจฺฉุงูพ
    
3. Start Docker
    

---

## ๐ฏ ูุชุฌู:

ุงู ุงุจุฒุงุฑูุง ุจุฑุง ูููุนุชโูุง ูุซู:

- ุงุฑุชูุงุก ุงูู
    
- disaster recovery
    
- migration
    
- ุงููุช ุณุฑูุณโูุง ุญุณุงุณ
    

ฺฉุงููุงู ุถุฑูุฑ ูุณุชู.

---

ุงฺฏู ุจุฎูุง ูโุชููู ฺฉ **ุณูุงุฑู ูุงูุน ุชุนูุฑ ููุฏุ quorum failureุ drain/restart/restore** ุทุฑุงุญ ฺฉูู ุชุง ููู ุฑู ุจุง ูู ุชูุฑู ฺฉูู ๐ ุจฺฏู ุขูุงุฏูโุง ุจุฑู ุนููุ