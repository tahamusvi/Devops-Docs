
---
### تفاوت overlay و ingress



اورلی شبکه بین چندتا سرویس روی چندتا نود مختلف هستش
اینگرس شبکه توزیع ترافیک بین رپلیکا ها هستش

---
### DNS داخلی در شبکه‌های overlay

کل قضیش اینه که هر سرویس در این شبکه dns name خودشو داره و بدون ip میتونه به بقیه وصل شه


---
### Published ports و load balancing داخلی Swarm


docker service create -p 8080:80 nginx

مثلا این پورت 8080 برای لود بالانسینگ بین نود ها میشه.
بدون استفاده از nginx 

---
### مفهوم Routing Mesh

قضیه اینه مثلا یه سرویس با n تا رپلیکا میاریم بالا روی m تا نود اگه یه نودی باشه که روش رپلیکایی هم نباشه اگه درخواست به پورت این سرویس بره روی اون نودی که رپلیکا نداره بازم سوارم درخواست رو میفرسته به یکی از رپلیکا ها



- فقط با `published ports` (یعنی `-p`) کار می‌کنه
- در بعضی موارد پیچیده (مثلاً WebSocket یا اتصال‌های بلندمدت) ممکنه مشکلاتی در routing یا sticky session ایجاد کنه
در این حالت‌ها بهتره از:

- **DNS Round Robin**
- یا external reverse proxy (مثل Traefik یا NGINX)  
    استفاده بشه

---

### Stack-level network design


networks:
  frontend:
    driver: overlay
  backend:
    driver: overlay

services:
  web:
    networks: [frontend, backend]
  redis:
    networks: [backend]



- کدوم سرویس‌ها عضو چه overlayای باشن
- چند تا شبکه جدا برای امنیت یا جداسازی بسازی

---

### Virtual IPs و internal service discovery


وقتی یک سرویس مثلاً `web` با ۳ replica داری:
- هر replica یک container با IP خاص داره
- ولی کل سرویس یک **Virtual IP (VIP)** داره
- وقتی کانتینری داخل overlay به `web` وصل شه، ترافیک می‌ره به VIP و Swarm خودش یکی از replicaها رو انتخاب می‌کنه