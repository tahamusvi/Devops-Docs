
من یه مقدار بیسیک دانش داکری داشتم اما این سری میخواستم واقعا یه درک عمیق تری پیدا کنم بخاطر همین اکثر آموزش ها بدردم نخورد رفتم شروع کنم با chatgpt به صحبت کردن.



خوب داکر یه کانتینر انجین هستش
Continer engine

cgroups 
namespaces


داکر با نیم اسپیس یه کار میکنه کانتینر فقط پروسس ها و شبکه ی خودش ببینه

با سی گروپس منابع رو تخصیص میده

با overlayfs یه سیستم فایل مجازی براش درست میکنه




خوب الان میخوام دقیقا بفهمم خوده داکر چطور کانتینر هارو میسازه.

یه دستور هستش به اسم chroot که میاد دایرکتوری root رو برای یه برنامه تغییر میده یعنی انگار روت فقط اون پوشه ایه که ما می خوایم.


دستور بعدی unshare هستش که میاد namespace های جدید pid و mount و net یعنی اون پروسس محیط خودش رو می سازه


debootstrap 
یه ابزار برای ساخت یه سیستم لینوکس مینیمال داخل یه پوشه


---

میخوام الان مرحله به مرحله کاری که داکر انجام میده توضیح بدم


مثلا ما تو ترمینال میزنیم
docker run ubuntu sh

درواقع داریم با داکر کلاینت ارتباط برقرار میکنیم که دستورات مارو به داکر دیمن بده



داکر دیمن درخواست های داکر(کلاینت) رو می گیره مثل یه بک اند و مثلا به زیرساخت خودش containerd درخواست میده



درواقع دیمن مسئول مونت گرفتن ایمیج و ساخت نتورک و والیوم و کانتینر و مدیریت لایف سایکل هستش


کانتینرد درواقع کانتینر هارو اجرا و مدیریت میکنه و image هارو کش میکنه و runc رو برای اجرای واقعی کانتینر ها صدا میزنه
این لایه واسط بین خوده داکر و ران سی هستش



runc 

مغز واقعی اجرای کانتینره 

از روی ایمیج یک rootfs درست میکنه
با استفاده از namespace ها پروسس ایزوله می سازه
cgroups تنظیم میکنه برای محدود کردن منابع

به کرنل میگه این کانتینره



اخرین لایه خوده کرنل لینوکس هستش



ما چه تو داکر و چه lxc میخوایم دسترسی هارو محدود کنیم این ها هرکدوم یه name space هستن

نیم اسپیس سازی برای کانتینر درواقع ایزوله کردن منابع هستش

با Cgroup میام دسترسی رو محدود میکنیم

|نوع Namespace|کاربرد|مثال|
|---|---|---|
|`pid`|ایزوله‌سازی Process IDs|هر کانتینر PID 1 مخصوص خودشو داره|
|`mnt`|ایزوله‌سازی Mount Points|هر کانتینر فایل‌سیستم خودش رو داره|
|`net`|ایزوله‌سازی Network Stack|هر کانتینر IP و port خودش رو داره|
|`ipc`|ایزوله‌سازی IPC مثل message queues|دو کانتینر نمی‌تونن با IPC سیستم اصلی ارتباط بگیرن|
|`uts`|ایزوله‌سازی Hostname و Domain|کانتینرها hostname خودشون رو دارن|
|`user`|ایزوله‌سازی User/UID|داخل کانتینر می‌تونی root باشی ولی تو میزبان نباشی|
|`cgroup`|ایزوله‌سازی کنترل منابع|ارتباط مستقیم با Cgroups (در ادامه توضیح می‌دیم)|


